<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:include="include/header::html"></head>
<body >
<div id="workingArea">
<div th:replace="include/top::html"></div>
<article class="clearfix">
    <div class="left_list fl" >
        <a href="#" target="_blank">
            <div class="img_one">
                <img :src="bestHotNews.url" class="lazy" />
                <h1>{{bestHotNews.title}}</h1>
            </div>
        </a>

        <div class="oli clearfix" v-for="r in recommendations">
            <a href="#" target="_blank" class="fl">
                <div class="oli_img">
                    <img :src="r.news.url"  class="lazy" />
                </div>
            </a>
            <div class="oli_font fr">
                <h3><a :href="'article?newsId='+r.news.id" @click="addLogs(r.news.id)">{{r.news.title}}</a></h3>
                <div class="description" v-html = "subString(r.news.content,0,100)">

                </div>
                <div class="clearfix">
                    <div class="data fl">
<!--                        <p class="author">编辑：admin</p>-->
                        <p class="date"><i></i><span>{{r.news.newsTime|formatDateFilter('YYYY-MM-DD')}}</span></p>
                    </div>
                    <div class="fenx fl">
                        <p class="sina"></p>
                        <p class="weixin">
                            <span><img src="static/upload/23434324.png" /></span>
                            <i></i>
                        </p>
                        <p class="qzone"></p>
                    </div>
                </div>
            </div>
        </div>

        <div v-if="recommendations.news != null">
            <a href="javascript:;" class="morearticle" >
                点击加载更多
            </a>
        </div>
        <div v-else>
        <div class="morearticle" >
            到底了
        </div>
    </div>
    </div>
    <div class="right_list fr">
        <div class="weekarticle">
            <h3>一周热议</h3>
            <div class="weekli" v-for="h in hotNews">
                <a href="#" target="_blank">
                    <div class="weekimg">
                        <img :src="h.url" class="lazy" />
                    </div>
                </a>
                <a href="#" target="_blank" class="weeklititle">
                    {{h.title}}
                </a>
            </div>
    </div>
    </div>
</article>
<div th:replace="include/footer::html" ></div>
</div>
<script>
    $(function () {
        const dataVue = {
            uri: 'recommendations',
            recommendations: [],
            hotNews:[],
            hotUri:'hot',
            bestHotUri:"hot_best",
            bestHotNews:'',
            logsUri:'logs'
        };

        const vue = new Vue({
            el:'#workingArea',
            data:dataVue,
            mounted:function () {
                this.load();
                this.hotLoad();
                this.bestHotLoad();
            },
            methods: {
                load:function () {
                    var url = this.uri;
                    axios.get(url).then(function (response) {
                        vue.recommendations = response.data;
                        vue.news = response.data.news;
                    });
                },
                hotLoad:function () {
                    const url = this.hotUri;
                    axios.get(url).then(function (response) {
                        vue.hotNews = response.data;
                    });
                },
                bestHotLoad:function () {
                    const url = this.bestHotUri;
                    axios.get(url).then(function (response) {
                        vue.bestHotNews = response.data;
                    });
                },
                addLogs:function (newsId) {
                    const url = this.logsUri+"?newsId="+newsId;
                    axios.post(url).then();
                }
            }
        });
    });
</script>
</body>
</html>